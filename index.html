<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diretório de Paróquias</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Diretório de Paróquias</h1>
        
        <div class="mb-4">
            <input type="text" id="searchInput" placeholder="Pesquisar..." class="w-full p-2 border rounded">
        </div>

        <div class="overflow-x-auto bg-white shadow-md rounded">
            <table class="min-w-full table-auto">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-4 py-2 text-left">Paróquia</th>
                        <th class="px-4 py-2 text-left">Orago</th>
                        <th class="px-4 py-2 text-left">Arciprestado</th>
                        <th class="px-4 py-2 text-left">Diocese</th>
                        <th class="px-4 py-2 text-left">Horários</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <div id="loading" class="text-center py-4">Carregando dados...</div>
        <div id="error" class="text-red-500 py-4 hidden"></div>
    </div>

    <script>
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');

        async function fetchData() {
            try {
                console.log('Iniciando busca de dados...');
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';

                const apiUrl = 'https://nocodb.pfontez.work/api/v2/tables/mktvik3e11yufuj/records?offset=0&limit=25&where=&viewId=vwahuj40bsx4vyqq&token=B0IcoK0fZq2GGaD4PniILZmXhrnt7MrSIcAiy6EO';
                
                console.log('Tentando acessar:', apiUrl);
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                if (!response.ok) {
                    throw new Error('Erro na resposta do proxy');
                }

                const data = await response.json();
                console.log('Resposta completa:', data);
                
                if (data.list) {
                    displayData(data.list);
                } else if (Array.isArray(data)) {
                    displayData(data);
                } else {
                    console.error('Formato de dados inesperado:', data);
                    throw new Error('Formato de dados inesperado');
                }

                console.log('Resposta recebida:', response);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Dados já foram processados acima
                
                displayData(data.list || []);
            } catch (error) {
                console.error('Erro detalhado:', error);
                errorEl.textContent = 'Erro ao carregar dados: ' + error.message;
                errorEl.style.display = 'block';
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        function displayData(data) {
            console.log('Exibindo dados:', data);
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = data.map(item => `
                <tr class="border-t hover:bg-gray-50">
                    <td class="px-4 py-2">${item.Paroquia || ''}</td>
                    <td class="px-4 py-2">${item.Orago || ''}</td>
                    <td class="px-4 py-2">${item.Arciprestado || ''}</td>
                    <td class="px-4 py-2">${item.Diocese || ''}</td>
                    <td class="px-4 py-2">${item.Horarios ? 'Ver horários' : ''}</td>
                </tr>
            `).join('');
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#tableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Iniciar busca quando a página carregar
        document.addEventListener('DOMContentLoaded', fetchData);
    </script>
</body>
</html>